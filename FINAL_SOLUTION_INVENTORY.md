# ‚úÖ –§–ò–ù–ê–õ–¨–ù–û–ï –†–ï–®–ï–ù–ò–ï: –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è–º–∏ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏

## üéØ –ü—Ä–æ–±–ª–µ–º–∞
–ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ `/inventory/management` –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å:
- –û—Å—Ç–∞—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –ª–æ–∫–∞—Ü–∏—è–º
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–∏ —Ç–æ–≤–∞—Ä–æ–≤
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤

## ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û–ï –†–ï–®–ï–ù–ò–ï

### 1. –ü—Ä–∏–Ω—Ü–∏–ø –ø–æ–¥—Å—á–µ—Ç–∞ –æ—Å—Ç–∞—Ç–∫–æ–≤
**–ü—Ä–æ—Å—Ç–æ–π –∏ –Ω–∞–¥–µ–∂–Ω—ã–π –ø–æ–¥—Ö–æ–¥**: `SUM(–ü—Ä–∏—Ö–æ–¥—ã - –†–∞—Å—Ö–æ–¥—ã)`

```sql
SUM(
  CASE 
    WHEN operation_type = 'supply' THEN quantity
    WHEN operation_type = 'sale' THEN -quantity
    WHEN operation_type = 'write_off' THEN -quantity
    WHEN operation_type = 'inventory' THEN quantity
    ELSE 0
  END
) as stock
```

### 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–î–≤–∞ –ø—Ä–æ—Å—Ç—ã—Ö VIEW –≤–º–µ—Å—Ç–æ —Å–ª–æ–∂–Ω—ã—Ö RPC —Ñ—É–Ω–∫—Ü–∏–π:**

1. `current_stock_view` - –æ–±—â–∏–µ –æ—Å—Ç–∞—Ç–∫–∏ –ø–æ —Ç–æ–≤–∞—Ä–∞–º
2. `stock_by_location_view` - –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –ª–æ–∫–∞—Ü–∏—è–º

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –û–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã –¥–ª—è –ª–æ–≥–∏–∫–∏ –ø–æ–¥—Å—á–µ—Ç–∞
- ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ –æ—Ç–ª–∞–¥–∫–∏
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ —Ç–∏–ø—ã –æ–ø–µ—Ä–∞—Ü–∏–π (`supply`, `sale`, `write_off`)
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞—Å—Ç–æ—è—â—É—é –∫–∞—Ä—Ç–∏–Ω—É (–≤–∫–ª—é—á–∞—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –æ—Å—Ç–∞—Ç–∫–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)

### 3. Backend API

**–£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ:**

```typescript
// –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å –∫ VIEW
const { data: stockData } = await supabase
    .from('stock_by_location_view')
    .select('product_id, location_id, location_name, stock')
    .eq('organization_id', organizationId)
    .in('product_id', productIds);
```

**–ë–µ–∑:**
- ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∏–∫–∏ –ø–æ–¥—Å—á–µ—Ç–∞
- ‚ùå –°–ª–æ–∂–Ω—ã—Ö RPC —Ñ—É–Ω–∫—Ü–∏–π
- ‚ùå Fallback –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏

### 4. –ß—Ç–æ –ù–ï –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å

**‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–æ–∂–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –∞–≥–µ–Ω—Ç–∞:**
- `database/create_current_stock_view.sql` (–∞–≥–µ–Ω—Ç–∞) - –ø–µ—Ä–µ—É—Å–ª–æ–∂–Ω–µ–Ω
- `database/add_test_data.sql` (–∞–≥–µ–Ω—Ç–∞) - —Ö—Ä—É–ø–∫–∏–µ UPDATE –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—è–º

**‚ùå –ü—Ä–æ–±–ª–µ–º—ã –ø–æ–¥—Ö–æ–¥–∞ –∞–≥–µ–Ω—Ç–∞:**
1. **–î–≤–∞ —Ä–∞–∑–Ω—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –ø–æ–¥—Å—á–µ—Ç–∞** - –∏—Å—Ç–æ—á–Ω–∏–∫ –æ—à–∏–±–æ–∫
2. **–ù–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∏–ø—ã –æ–ø–µ—Ä–∞—Ü–∏–π** - `'purchase', 'receipt', 'incoming'`
3. **–°–∫—Ä—ã—Ç–∏–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –æ—Å—Ç–∞—Ç–∫–æ–≤** - –ø–æ—Ç–µ—Ä—è –≤–∞–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
4. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏** - VIEW + RPC —Ñ—É–Ω–∫—Ü–∏—è
5. **–•—Ä—É–ø–∫–∏–µ UPDATE —Å–∫—Ä–∏–ø—Ç—ã** - –ø—Ä–∏–≤—è–∑–∫–∞ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –Ω–∞–∑–≤–∞–Ω–∏—è–º

## üöÄ –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –í–ù–ï–î–†–ï–ù–ò–Æ

### –®–∞–≥ 1: –í—ã–ø–æ–ª–Ω–∏—Ç–µ –ü–†–ê–í–ò–õ–¨–ù–´–ô SQL
```sql
-- –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞: database/CORRECT_current_stock_view.sql
```

### –®–∞–≥ 2: Backend —É–∂–µ –≥–æ—Ç–æ–≤
–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ—Å—Ç—ã–º–∏ VIEW.

### –®–∞–≥ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# API Test
curl http://localhost:3000/api/inventory/products-test

# Frontend
http://localhost:5173/inventory/management
```

## üìä –û–ñ–ò–î–ê–ï–ú–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢

**API –≤–µ—Ä–Ω–µ—Ç –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```json
{
  "product_id": 57,
  "product_name": "Mistral Japonica Rice 900g",
  "manufacturer": { "id": 1, "name": "Mistral" },
  "category": { "id": 1, "name": "–ö—Ä—É–ø—ã –∏ –∑–ª–∞–∫–∏" },
  "stock_by_location": [
    { 
      "location_id": 1, 
      "location_name": "–û—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥", 
      "stock": 29 
    }
  ]
}
```

**–ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –æ—Ç–æ–±—Ä–∞–∑—è—Ç—Å—è:**
- ‚úÖ –û—Å—Ç–∞—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–∏ 
- ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
- ‚úÖ –†–∞–±–æ—á–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ï –ü–†–ò–ù–¶–ò–ü–´

### DRY (Don't Repeat Yourself)
- –û–¥–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–æ–¥—Å—á–µ—Ç–∞ –æ—Å—Ç–∞—Ç–∫–æ–≤ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
- VIEW –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### KISS (Keep It Simple, Stupid)
- –ü—Ä–æ—Å—Ç—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã
- –ü–æ–Ω—è—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞: –ü—Ä–∏—Ö–æ–¥ - –†–∞—Å—Ö–æ–¥ = –û—Å—Ç–∞—Ç–æ–∫

### –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
1. **VIEW** - –∞–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
2. **Backend** - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è API
3. **Frontend** - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ `current_stock_view` - –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞—Ç–∫–∏
- ‚úÖ `stock_by_location_view` - –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –ª–æ–∫–∞—Ü–∏—è–º

### Backend  
- ‚úÖ –ü—Ä–æ—Å—Ç—ã–µ SELECT –∑–∞–ø—Ä–æ—Å—ã –∫ VIEW
- ‚úÖ JOIN —Å manufacturers –∏ categories
- ‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –Ω—É–∂–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É

### Frontend
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è–º

## üìà –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–æ–ª—è
- VIEW —Å –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è–º–∏
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ JOIN-—ã

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ê–Ω–∞–ª–∏–∑ –ø–ª–∞–Ω–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ –º–µ—Ä–µ —Ä–æ—Å—Ç–∞ –¥–∞–Ω–Ω—ã—Ö

---

## ‚úÖ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–ù–∞—à–µ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ—â–µ, –Ω–∞–¥–µ–∂–Ω–µ–µ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ –ø–æ–¥—Ö–æ–¥–∞ "–∞–≥–µ–Ω—Ç–∞".

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:**
- Backend API –æ–±–Ω–æ–≤–ª–µ–Ω ‚úÖ
- Frontend —Å–æ–≤–º–µ—Å—Ç–∏–º ‚úÖ  
- SQL —Å–∫—Ä–∏–ø—Ç—ã –≥–æ—Ç–æ–≤—ã ‚úÖ
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–ª–Ω–∞—è ‚úÖ

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –í—ã–ø–æ–ª–Ω–∏—Ç–µ `database/CORRECT_current_stock_view.sql` –≤ Supabase. 